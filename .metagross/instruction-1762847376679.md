# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 95%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Entitlements API endpoint does not use Redis caching - cache functions exist (cache_entitlements, get_cached_entitlements) but are not called in entitlements_api.py. Spec requires <100ms p95 latency with caching enabled. Current implementation queries database directly without cache check.
3. Fix major bug: Test suite has incorrect health endpoint path: test_api.py line 27 calls '/health' but actual endpoint is '/healthz' - test will fail
4. Follow-up from reflection: Project is production-ready with all core functional requirements implemented: checkout/portal sessions, webhook processing with idempotency (5 required event types), entitlement computation engine (subscriptions/purchases/manual grants), reconciliation system with scheduled daily job (APScheduler), admin grant/revoke endpoints, metrics endpoint, project-scoped authentication, health checks, and comprehensive documentation. Database schema complete with all required models. Missing Redis cache usage in entitlements API is a performance gap preventing <100ms p95 target but not blocking functionality. Recommended next steps: 1) Add cache check/update in entitlements_api.py get_entitlements endpoint, 2) Fix test_health_endpoint to use /healthz path, 3) Verify test coverage meets 85% threshold, 4) Run end-to-end validation with Stripe test webhooks, 5) Consider adding cache warming on startup for frequently accessed entitlements.

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
