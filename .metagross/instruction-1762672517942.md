# Metagross Instruction (stage=build)

Reflection review flagged outstanding work. Address the following items:
- Completion is at 95%. Raise to 100% by finishing outstanding requirements.
- Critical gap: Missing unique constraint on users table: (project_id, external_user_id) composite unique constraint is documented in models.py comment but not implemented in migration. This allows duplicate users per project, violating data integrity requirements.
- Notes: Implementation is nearly production-ready with all core functional requirements met: checkout/portal sessions, webhook processing with idempotency, entitlement computation from subscriptions/purchases/manual grants, Redis caching, reconciliation system, admin endpoints, metrics, and comprehensive documentation. 74 test functions exist across 14 test files covering all major components. The missing unique constraint on users table is the primary blocker preventing 1.0 completion. Recommended next steps: 1) Add migration to create unique constraint on users(project_id, external_user_id), 2) Verify test coverage meets 85% threshold via 'make test', 3) Run end-to-end validation with Stripe test webhooks, 4) Address any test failures discovered during validation.

After completing these tasks, rerun docker compose build, lint, typecheck, and tests, then provide updated evidence.
