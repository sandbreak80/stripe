# Metagross Instruction (stage=build)

Reflection review flagged outstanding work. Address the following items:
- Completion is at 75%. Raise to 100% by finishing outstanding requirements.
- Critical gap: Admin API endpoints missing: Spec requires POST /api/v1/admin/grant and POST /api/v1/admin/revoke endpoints for manual entitlement management with audit trail. ManualGrant model exists and is used in entitlement computation, but no API endpoints exist to create/revoke grants.
- Critical gap: Reconciliation system missing: Spec requires daily reconciliation job to sync Stripe data with local database to prevent drift. No reconciliation implementation found (no reconciliation.py file, no scheduled jobs, no drift detection logic).
- Critical gap: Metrics endpoints missing: Spec requires basic metrics per project (active subscriptions, MRR estimate). No metrics endpoints found despite prometheus-client dependency being present.
- Notes: Core payment infrastructure is production-ready: checkout/portal sessions, webhook processing with idempotency (5 event types), entitlement computation engine (subscriptions/purchases/manual grants), Redis caching, database models, authentication, health checks, and comprehensive documentation. 27 test functions exist covering major components. However, three critical administrative/operational features from spec are missing: admin grant/revoke endpoints, reconciliation system, and metrics endpoints. These gaps prevent full production readiness as operators cannot manually manage entitlements, detect data drift, or monitor business metrics. Recommended next steps: 1) Implement admin API endpoints for manual grants/revokes with audit trail, 2) Build reconciliation system with scheduled daily job, 3) Add metrics endpoints for project-level subscription/revenue data, 4) Verify test coverage meets 85% threshold, 5) Run end-to-end validation with Stripe test webhooks.

After completing these tasks, rerun docker compose build, lint, typecheck, and tests, then provide updated evidence.
