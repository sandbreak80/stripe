# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 85%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Test coverage is 62% (specification requires ≥85% unit test coverage and ≥70% integration test coverage). Core entitlements logic has 80% coverage, but overall coverage falls short of specification targets.
3. Resolve critical gap: Performance testing not executed. Specification requires <100ms p95 latency for entitlement checks, but load testing has not been performed to verify this target under production conditions.
4. Resolve critical gap: Test infrastructure issues preventing full test execution. 12 tests are failing due to async/mocking issues, limiting comprehensive validation of the system.
5. Fix major bug: 12 tests failing due to test infrastructure issues (async/mocking problems). Core functionality is validated, but comprehensive test suite execution is blocked.
6. Fix major bug: Type checking errors present (30 errors, mostly SQLAlchemy typing issues). While non-blocking per specification, these indicate incomplete type safety.
7. Follow-up from reflection: The Centralized Billing & Entitlements Service is functionally complete with all core requirements implemented: checkout API, entitlements API, portal API, webhook processing (5 event types), admin endpoints, reconciliation system, and complete database schema. Documentation is comprehensive (architecture, API reference, operations, setup guides). Docker containerization is ready. Core business logic (entitlements engine) has 80% test coverage, providing production confidence. However, overall test coverage at 62% falls short of specification targets (≥85% unit, ≥70% integration). Performance targets (<100ms p95) have not been verified under load. Recommended next steps: 1) Increase test coverage for event processors (currently 15.7%) and reconciliation (52.5%), 2) Execute load testing to verify performance targets, 3) Fix test infrastructure issues to enable full test execution, 4) Add Prometheus metrics for operational monitoring. The system is production-ready for core use cases but requires validation gate completion before full production deployment.

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
