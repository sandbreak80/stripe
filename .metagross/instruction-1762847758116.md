# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 75%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Test coverage at 54.4% falls below specification targets (≥85% unit, ≥70% integration). Core entitlements logic at 80% meets unit target, but overall coverage is insufficient.
3. Resolve critical gap: Prometheus metrics dependency present but not fully implemented. Health checks and business metrics available via API, but Prometheus export endpoint not operational.
4. Resolve critical gap: Test infrastructure issues: 13 tests failing due to async/mocking complexities preventing comprehensive test execution. While non-blocking per SPEC_COMPLIANCE.md, this limits validation coverage.
5. Resolve critical gap: Performance testing not executed. Redis caching implemented but <100ms p95 latency target not verified under load.
6. Resolve critical gap: Limited test coverage for critical components: event_processors.py (16%), reconciliation.py (14%), webhook_verification.py (30%), webhooks.py (33%)
7. Fix major bug: Test suite has 13 failing tests due to async/mocking infrastructure issues. Core functionality validated but edge cases may be missed.
8. Fix major bug: Type checking reports 30 errors (mostly SQLAlchemy typing issues, marked as non-blocking but indicates type safety gaps).
9. Fix major bug: Linting reports 96 errors (83 auto-fixable style warnings, but indicates code quality issues).
10. Follow-up from reflection: Implementation is functionally complete with all required APIs (checkout, entitlements, portal, webhooks, admin, metrics), 5 webhook event processors with idempotency, complete database schema with migrations, Docker containerization, daily reconciliation scheduler, and comprehensive documentation. Core business logic (entitlements engine) is well-tested at 80% coverage. System is production-ready for core use cases but requires test coverage improvements and performance validation before full production deployment. Recommended next steps: 1) Increase test coverage for event processors and reconciliation to meet ≥85% unit target, 2) Fix test infrastructure issues to enable full test execution, 3) Implement Prometheus metrics export, 4) Execute load testing to verify <100ms p95 latency target, 5) Address linting and type checking issues incrementally.

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
