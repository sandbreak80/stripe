# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 82%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Test coverage below specification targets: 67.3% overall (spec requires ≥85% unit, ≥70% integration). Core entitlements logic at 80% meets unit target, but overall coverage gap prevents full compliance.
3. Resolve critical gap: Performance testing not executed. Specification requires verification of <100ms p95 latency for entitlement checks under load. Redis caching implemented but performance targets not validated.
4. Resolve critical gap: Test infrastructure issues: 18 tests failing due to async/mocking problems per SPEC_COMPLIANCE.md. While non-blocking per directive, prevents comprehensive validation of all code paths.
5. Fix major bug: Test execution failures: 18 tests failing (down from 21) due to async/mocking infrastructure issues. Core functionality validated but full test suite cannot execute completely.
6. Fix major bug: Code quality issues: 96 linting errors (83 auto-fixable) and 30 type checking errors per SPEC_COMPLIANCE.md. Non-blocking but indicates incomplete validation gates.
7. Follow-up from reflection: Project is functionally complete with all core APIs, webhooks, entitlements computation, reconciliation, and documentation implemented. Database schema complete with all required models. Security measures (webhook verification, API key hashing, audit trails) in place. Docker containerization ready. SPEC_COMPLIANCE.md indicates 'production-ready for core use cases' but test coverage below spec targets (67.3% vs ≥85% unit, ≥70% integration) prevents full compliance. Core business logic (entitlements engine) well-tested at 80% coverage. Recommended next steps: 1) Increase test coverage for event processors (currently 35.5%) and reconciliation (52.5%), 2) Fix test infrastructure issues to enable full test execution, 3) Execute load testing to verify performance targets, 4) Address linting/typing errors for complete validation gate compliance. Project suitable for production deployment with understanding that test coverage improvements should be prioritized post-launch.

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
