# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 87%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Test coverage below specification targets: 67.3% overall vs ≥85% unit and ≥70% integration requirements. Core entitlements logic (80%) meets targets, but event processors (35.5%), webhook endpoint (33.3%), and reconciliation (52.5%) need improvement.
3. Resolve critical gap: Test infrastructure issues: 18 tests failing due to async/mocking problems preventing full validation. Core functionality validated but comprehensive test execution blocked.
4. Resolve critical gap: Performance testing not executed: <100ms p95 latency target for entitlement checks not verified under load. Redis caching implemented but load testing required before production.
5. Fix major bug: Webhook error handling returns 500 on processing failures, triggering Stripe retries. Should handle transient errors gracefully without causing retry storms.
6. Fix major bug: Reconciliation system has pass statements in error handling paths (reconciliation.py:154) indicating incomplete error recovery logic.
7. Follow-up from reflection: Project is functionally complete with all core APIs, webhooks, entitlements engine, reconciliation, and documentation implemented. All required endpoints operational: checkout, entitlements, portal, webhooks, admin (grant/revoke/reconcile), metrics, and health checks. Database schema complete with all models. Docker containerization ready. Core business logic (entitlements engine) well-tested at 80% coverage. SPEC_COMPLIANCE.md indicates production-ready status for core use cases. Recommended next steps: 1) Increase test coverage for event processors and webhook endpoint to meet spec targets, 2) Fix test infrastructure async/mocking issues to enable full test execution, 3) Execute load testing to verify performance targets, 4) Complete error handling in reconciliation system, 5) Add Prometheus metrics export (dependency present but not fully implemented).

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
