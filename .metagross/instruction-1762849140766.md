# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 75%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Test coverage below specification targets: 67% overall vs required ≥85% unit and ≥70% integration. Core entitlements logic meets target (80%), but critical components lack adequate coverage: admin endpoints (0% for create_grant, revoke_grant, trigger_reconciliation), event processors (35% overall, ChargeRefundedProcessor 5%, CheckoutSessionCompletedProcessor internal methods 0%), webhook endpoint (28%), checkout API (55%), portal API (54%)
3. Resolve critical gap: Admin API endpoints lack test coverage: POST /api/v1/admin/grant, POST /api/v1/admin/revoke, and POST /api/v1/admin/reconcile have 0% test coverage per coverage.json, preventing validation of manual entitlement management and reconciliation trigger functionality
4. Resolve critical gap: Event processor implementation gaps: CheckoutSessionCompletedProcessor._process_subscription and _process_payment methods show 0% coverage, ChargeRefundedProcessor.process shows 5% coverage, indicating incomplete testing of critical webhook event handling paths
5. Follow-up from reflection: Project is functionally complete with all required APIs, database schema, webhook processing, reconciliation system, and documentation implemented. Core entitlements engine is well-tested (80% coverage). However, validation gates are not fully satisfied: test coverage is 67% overall (below ≥85% unit and ≥70% integration targets). Admin endpoints and some event processors lack test coverage, preventing confidence in production readiness. Recommended next steps: (1) Add comprehensive tests for admin endpoints (grant, revoke, reconcile), (2) Increase coverage for event processors, especially ChargeRefundedProcessor and CheckoutSessionCompletedProcessor internal methods, (3) Add integration tests for webhook endpoint, (4) Execute load testing to verify <100ms p95 latency target for entitlements API, (5) Conduct security audit before production deployment. The system is suitable for staging deployment but requires test coverage improvements before production.

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
