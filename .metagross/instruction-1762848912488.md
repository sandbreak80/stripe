# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 85%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Test coverage at 67.3% falls below specification targets (≥85% unit, ≥70% integration). Core business logic (entitlements.py) achieves 80% coverage, but event processors (35.5%), webhook endpoint (33.3%), and reconciliation (52.5%) have insufficient coverage.
3. Resolve critical gap: Performance testing not executed - performance targets (<100ms p95 latency for entitlement checks) remain unverified under load.
4. Resolve critical gap: Test infrastructure issues: 18 tests failing due to async/mocking problems prevent comprehensive validation of critical functionality including checkout, entitlements, auth, cache, event processors, reconciliation, and webhook verification.
5. Fix major bug: Code quality validation gates not met: 96 linting errors present (83 auto-fixable, 13 require manual fixes) and 30 type checking errors (mostly SQLAlchemy typing issues) indicating incomplete code quality standards.
6. Fix major bug: Test suite has 18 failing tests due to async/mocking infrastructure issues - core functionality validated but edge cases may be missed, preventing full confidence in production deployment.
7. Follow-up from reflection: Project is functionally complete with all core APIs (checkout, entitlements, portal, webhooks, admin grant/revoke/reconcile, metrics), database schema with migrations, webhook processing for 5 critical Stripe events with idempotency, entitlements computation engine, reconciliation system with daily scheduler, Redis caching, authentication, webhook signature verification, Docker containerization, and comprehensive documentation (README, architecture, API reference, operations, SETUP, SPEC_COMPLIANCE). Core business logic (entitlements engine) is well-tested at 80% coverage providing production confidence. However, overall test coverage at 67.3% falls below specification targets, performance testing has not been executed to verify SLOs, and test infrastructure issues prevent full validation. Recommended next steps: (1) Fix test infrastructure async/mocking issues to resolve 18 failing tests, (2) Increase test coverage for event processors and webhook endpoint to meet ≥85% unit target, (3) Execute load testing to verify <100ms p95 latency requirement, (4) Address linting and type checking errors to meet code quality gates, (5) Add comprehensive integration tests for reconciliation and scheduler components. System is suitable for production deployment with monitoring for core use cases, but test coverage improvements and performance validation should be prioritized in first post-launch iteration.

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
