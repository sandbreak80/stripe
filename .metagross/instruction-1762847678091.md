# Metagross Instruction (stage=build)

Reflection backlog items remain unresolved. Implement the following before returning to validation:

1. Raise implementation completeness to 100% (currently 75%). Address every missing requirement identified by reflection.
2. Resolve critical gap: Test coverage at 59% falls below specification targets (≥85% unit, ≥70% integration). Core entitlements logic at 80% meets unit target, but event processors (16%), reconciliation (53%), and webhook verification (30%) are significantly below targets
3. Resolve critical gap: 13+ test failures prevent full validation of implementation. Test infrastructure issues with async/mocking prevent comprehensive test execution
4. Resolve critical gap: Admin API contains critical bug: line 67 in admin.py references undefined variable 'reason' instead of 'request.reason', causing runtime error in grant creation endpoint
5. Fix major bug: Admin API grant endpoint will crash at runtime: undefined variable 'reason' on line 67 should be 'request.reason'
6. Fix major bug: Test suite has 13+ failing tests preventing validation of checkout, entitlements, auth, cache, event processors, reconciliation, and webhook verification functionality
7. Fix major bug: Type checking reports 30 errors (mostly SQLAlchemy typing issues) indicating potential runtime type safety issues
8. Follow-up from reflection: Project is functionally complete with all core APIs, database schema, webhook processing, reconciliation, and documentation implemented. Core business logic (entitlements engine) is well-tested at 80% coverage. However, test coverage below specification targets (59% vs ≥85% unit, ≥70% integration) and critical bugs prevent production readiness. The admin API bug must be fixed immediately. Test infrastructure issues need resolution to enable full validation. Code quality issues (96 linting errors, 30 type errors) should be addressed but are non-blocking. Recommendation: Fix admin API bug, resolve test infrastructure issues, and increase coverage for event processors and reconciliation before production deployment.

After addressing these items, run inside Docker/Compose:
- `docker compose build`
- `make lint`
- `make typecheck`
- `make test`

Capture the resulting logs under `artifacts/` and provide an updated evidence block showing the new test results and coverage.
