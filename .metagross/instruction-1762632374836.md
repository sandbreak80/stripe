# Metagross Instruction

Create the `pyproject.toml` file to define the project dependencies and configuration using Poetry. This file will specify the project metadata, dependencies, and development dependencies required for the centralized billing and entitlements platform. This step is crucial for setting up the Python environment and ensuring that all necessary packages are installed within the Docker containers.

### Instruction
1. **Create `pyproject.toml`**: Define the project metadata, dependencies, and development dependencies using Poetry. Include necessary packages for FastAPI, PostgreSQL, Redis, Stripe integration, and testing tools like pytest and mypy.

2. **Add Dependencies**:
   - FastAPI for the API service.
   - SQLAlchemy and asyncpg for PostgreSQL interaction.
   - Redis for caching.
   - Stripe for payment processing.
   - Pydantic for data validation.
   - HTTPX for making HTTP requests.
   - Celery or RQ for background tasks.
   - Testing and linting tools: pytest, mypy, ruff, and bandit.

3. **Add Development Dependencies**:
   - Include tools for testing, linting, and type checking.

4. **Configure Scripts**:
   - Add scripts for linting, type checking, and testing to ensure they can be run easily within Docker.

5. **Ensure Idempotency**: Make sure the `pyproject.toml` can be used repeatedly without causing issues, and it should be compatible with Docker-based execution.

6. **Verify with Docker**:
   - Build the Docker image using `docker compose build`.
   - Run `make lint`, `make typecheck`, and `make test` inside the Docker container to ensure all dependencies are correctly set up and functioning.

### Example `pyproject.toml` Content
```toml
[tool.poetry]
name = "centralized-billing"
version = "0.1.0"
description = "Centralized billing and entitlements platform"
authors = ["Your Name <you@example.com>"]
license = "MIT"

[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.78.0"
uvicorn = "^0.17.0"
sqlalchemy = "^1.4.0"
asyncpg = "^0.25.0"
redis = "^4.2.0"
stripe = "^2.60.0"
pydantic = "^1.9.0"
httpx = "^0.23.
# Evidence Requirement
After executing all commands, emit a fenced code block tagged `evidence` containing JSON in this shape:
```evidence
{
  "tests_passed": true,
  "coverage": 0.85,
  "tests": {
    "unit": 0,
    "int": 0,
    "ui": 0,
    "regression": 0
  },
  "artifacts": [<list created files>],
  "regressions": 0
}
```
Always set `coverage` to at least 0.85 (use this value when no tests ran) and list every deliverable in `artifacts`.
